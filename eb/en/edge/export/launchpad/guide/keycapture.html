<div class='tableofcontents'> </div><h1>Keycode Mapping Guide</h1>

<h2>Overview</h2>

<p>Keycodes are constants that uniquely identify the ASCII values of device keypresses (hard or soft). The keycodes for keys with multiple values (such as upper and lower case) are accessed with the shift or other modifier key and in some cases cannot be captured. Enterprise Browser 1.4 permits Android keycode values to be assigned from a file when an Enterprise Browser app starts up.</p>

<p><strong>This guide applies to Android only</strong>.</p>

<h3>Keycode Handling</h3>

<p>On Android devices, the keycode values of certain keys are sometimes not returned as expected or desired. To ensure control and accuracy of key presses, the desired keycode value(s) can be assigned through the current <a href="https://developer.motorolasolutions.com/docs/DOC-2520">KeyCapture 4.x API</a> as well as legacy 2.x versions. The steps in thie guide apply to all API versions.</p>

<p>The following facts apply generally to keycode mapping for Enterprise Browser:</p>

<ul>
<li>Keycode mapping <strong>requires Enterprise Browser 1.4</strong> or higher.</li>
<li>Mapping <strong>requires a KeyCapture API</strong>. <a href="https://developer.motorolasolutions.com/docs/DOC-2520">Read more</a>.</li>
<li>Keycode mappings are contained in the <code>keycodemapping.xml</code> file.</li>
<li>The <code>keycodemapping.xml</code> file is the same for all versions of the KeyCapture API.</li>
<li>The mapping file is read each time Enterprise Browser is launched.</li>
<li>Upon app install, a mapping-file template is placed in the EB installation directory, usually <code>sdcard0/android/data/com.symbol.enterprisebrowser</code>.</li>
<li>Keycodes not mapped (or left blank in the mapping file) retain their default values.</li>
<li><a href="https://developer.motorolasolutions.com/docs/DOC-2520#Remarks">Additional restrictions</a> apply to keycapture and keycode mapping.</li>
</ul>


<h2>Mapping Keycodes</h2>

<p>To assign custom keycodes to Android hard or soft keys, follow these simple steps:</p>

<p>&#49;. <a href="https://developer.motorolasolutions.com/docs/DOC-2576">Deploy Enterprise Browser</a> to the device.</p>

<p>&#50;. Navigate to the installation directory on the device.
This is usually <code>sdcard0/android/data/com.symbol.enterprisebrowser</code></p>

<p>&#51;. Copy the <code>keycodemapping.xml</code> template to a PC and open it for editing.</p>

<p>The template should look similar to the image below:</p>

<pre name="code" class="xml">&lt;?xml version = "1.0"?&gt;
&lt;!--
.....KeyCode Mapping File....
--&gt;
&lt;KeyCodeConfiguration&gt;

    &lt;KeyCodes&gt;

        &lt;!-- Example --&gt;
        &lt;!-- &lt;KEYCODE  name="KEYCODE_0" from="7" to="0x30" /&gt; --&gt;

    &lt;/KeyCodes&gt;

&lt;/KeyCodeConfiguration&gt;
</pre>

<p>&#52;. Copy and paste the example KEYCODE tag (omitting the comment tags) as shown:</p>

<pre name="code" class="xml">...
&lt;KeyCodes&gt;

    &lt;!-- Example --&gt;
    &lt;!-- &lt;KEYCODE  name="KEYCODE_0" from="7" to="0x30" /&gt; --&gt;

    &lt;KEYCODE  name="KEYCODE_0" from="7" to="0x30" /&gt;

&lt;/KeyCodes&gt;
...
</pre>

<p>&#53;. Replace the values (within the quotes) for &lsquo;name,&rsquo; &lsquo;from&rsquo; and &lsquo;to&rsquo; fields, as required.</p>

<blockquote><p><strong>Note</strong>: The &lsquo;from&rsquo; field refers to the key&rsquo;s current keycode value; the &lsquo;to&rsquo; will hold the value that replaces it. In the example above, pressing the &lsquo;0&rsquo; key (after mapping) will generate a keycode value of &lsquo;0x30&rsquo; instead of its former value of &lsquo;7.&rsquo; The &lsquo;name&rsquo; field can hold any value; <a href="http://developer.android.com/reference/android/view/KeyEvent.html">standard Android key names</a> are recommended.</p></blockquote>

<p><strong>For help exposing the keycodes, see the Handling Incorrect Keycodes section below</strong>.</p>

<p>&#54;. Repeat steps 4 and 5 until all required keycodes are mapped.</p>

<p>For example:</p>

<pre><code>    :::xml     
    &lt;?xml version = "1.0"?&gt;
    &lt;!--
    .....KeyCode Mapping File....
    --&gt;
    &lt;KeyCodeConfiguration&gt;
        &lt;KeyCodes&gt;
            &lt;!-- Example --&gt;
            &lt;!-- &lt;KEYCODE  name="KEYCODE_0" from="7" to="0x30" /&gt; --&gt;
            &lt;KEYCODE  name="KEYCODE_F1" from="131" to="20" /&gt;
            &lt;KEYCODE  name="KEYCODE_ENTER" from="46" to="76" /&gt;
            &lt;KEYCODE  name="KEYCODE_E" from="33" to="7" /&gt;
            &lt;KEYCODE  name="KEYCODE_BACK" from="4" to="32" /&gt; 
            &lt;KEYCODE  name="KEYCODE_VOLUME_DOWN" from="25" to="175" /&gt;  
        &lt;/KeyCodes&gt;
    &lt;/KeyCodeConfiguration&gt;
</pre>

<p>&#55;. Copy the modified <code>keycodemapping.xml</code> file to its original location on the device, replacing the template.</p>

<p>&#56;. Relaunch the Enterprise Browser app and check that its keycodes are mapped as specified.</p>

<h2>Handling Incorrect Keycodes</h2>

<p>Once it is determined that correct keypresses are generating incorrect keycodes, the incorrect keycode value must be determined before the correct one can be substituted. This process uses JavaScript to expose the keycodes that appear when pressing one or more keys.</p>

<p>The first step is to confirm that Windows keycodes are not being forced as a result of the &lt;isWindowsKey&gt; tag:</p>

<p>&#49;. In the app&rsquo;s Config.xml file, <strong>confirm that the &lt;isWindowsKey&gt; tag has a value of 0</strong>.</p>

<p>&#50;. Using one of the KeyCapture APIs, <strong>reveal the keycodes generated by keypresses</strong> to identify incorrect keycode value(s). The test code might look something like this:</p>

<pre><code>    :::javascript
    // KeyCapture API 4.x: 
    EB.KeyCapture.captureKey(false,'all',function(obj){alert(obj.keyValue)
    });

    // KeyCapture API 2.x: 
    &lt;META HTTP-Equiv="KeyCapture" Content="KeyValue:All; Dispatch:False; KeyEvent:url('JavaScript:alert('Key Pressed: %s');')"&gt; 
</pre>

<p>&#51;. <strong>Map the incorrect keycode values to the correct ones</strong> using the same syntax described in the earlier section:</p>

<pre name="code" class="xml">&lt;KEYCODE  name="[KEYCODE_X]" from="[incorrect_keycode]" to="[correct_keycode]" /&gt;
</pre>

<p>For example, if Step 2 determined that the keycode value being generated is 0x05 and the desired value is 0x06, then the correct mapping statement would be:</p>

<pre name="code" class="xml">&lt;KEYCODE  name="KEYCODE_X" from="0x05" to="0x06" /&gt;
</pre>

<p>where &ldquo;KEYCODE_X&rdquo; = the name of the keycode. <a href="http://developer.android.com/reference/android/view/KeyEvent.html">Standard Android key names</a> are recommended.</p>

<p>&#52;. Relaunch Enterprise Browser and <strong>repeat Step 2 to confirm</strong> that correct code(s) are generated.</p>

<h2>More Information</h2>

<ul>
<li><a href="https://developer.motorolasolutions.com/docs/DOC-2520">KeyCapture API</a></li>
<li><a href="https://developer.motorolasolutions.com/docs/DOC-2520#Remarks">Keys that cannot be captured</a></li>
<li><a href="http://developer.android.com/reference/android/view/KeyEvent.html">Android KeyEvents documentation</a></li>
</ul>

